# TikTok Cookies Setup Guide

## Problem
TikTok now requires authentication (cookies) to download videos. Without cookies, you'll see errors like:
```
TikTok is requiring login for access to this content. Use --cookies-from-browser or --cookies
```

## Solution Options

### Option 1: Export Cookies from Browser (Recommended)

1. **Install Browser Extension**:
   - Chrome/Edge: Install "Get cookies.txt LOCALLY" extension
   - Firefox: Install "cookies.txt" extension

2. **Login to TikTok**:
   - Open TikTok in your browser
   - Make sure you're logged in

3. **Export Cookies**:
   - Click the extension icon
   - Select "tiktok.com" domain
   - Click "Export" or "Copy"
   - Save to: `integrations/cookies/tiktok_cookies.txt`

4. **Verify File**:
   - File should be in Netscape format
   - First line: `# Netscape HTTP Cookie File`
   - Each cookie on one line: `domain	flag	path	secure	expiration	name	value`

### Option 2: Automatic Browser Cookie Extraction

The code will automatically try to extract cookies from Chrome if:
- You're logged into TikTok in Chrome
- `browser_cookie3` package is installed (optional, yt-dlp handles this)

To enable:
```bash
pip install browser-cookie3
```

### Option 3: Manual Cookie File

Create `integrations/cookies/tiktok_cookies.txt` manually:

```
# Netscape HTTP Cookie File
# This file was generated by APIBR2
# Format: domain	flag	path	secure	expiration	name	value

.tiktok.com	TRUE	/	TRUE	1735689600	s_v_web_id	your_session_id_here
.tiktok.com	TRUE	/	TRUE	1735689600	tt_chain_token	your_token_here
```

**Important cookies to include:**
- `s_v_web_id` - Session ID
- `tt_chain_token` - Authentication token
- `sid_tt` - Session token
- `uid_tt` - User ID

## File Location

Cookies should be saved at:
```
APIBR2/integrations/cookies/tiktok_cookies.txt
```

## Testing

After setting up cookies, test with:
```bash
curl -X POST http://localhost:5002/tiktok/download \
  -H "Content-Type: application/json" \
  -d '{"url": "https://www.tiktok.com/@username/video/1234567890"}'
```

## Troubleshooting

### Error: "Unable to extract webpage video data"

This usually means:
1. **yt-dlp is outdated** - TikTok changes their API frequently
   ```bash
   # Windows PowerShell
   .\update_ytdlp.ps1
   
   # Linux/macOS
   chmod +x update_ytdlp.sh && ./update_ytdlp.sh
   
   # Or manually
   pip install --upgrade yt-dlp
   ```

2. **Cookies expired** - Re-export fresh cookies from browser

3. **TikTok changed their API** - Check yt-dlp GitHub issues: https://github.com/yt-dlp/yt-dlp/issues

4. **Video is private/restricted** - Some videos require specific permissions

### Cookies expired
- Cookies expire after some time
- Re-export cookies if downloads start failing

### Still getting login errors
- Make sure you're logged into TikTok in the browser
- Verify cookie file format (Netscape format)
- Check file permissions (readable by Python process)

### Browser cookie extraction not working
- Install `browser-cookie3`: `pip install browser-cookie3`
- Or use manual cookie file export (Option 1)

### Video accessible in browser but not downloading
1. Update yt-dlp to latest version (see above)
2. Export fresh cookies
3. Check yt-dlp GitHub for known TikTok issues
4. Try a different TikTok video to isolate the problem

## Security Note

⚠️ **Never commit cookie files to Git!**
- Add `cookies/*.txt` to `.gitignore`
- Cookies contain authentication tokens
- Keep cookies private and secure

